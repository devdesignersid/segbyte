(this["webpackJsonp@coreui/coreui-free-react-admin-template"]=this["webpackJsonp@coreui/coreui-free-react-admin-template"]||[]).push([[8],{796:function(e,t,n){"use strict";n.r(t);var o=n(172),c=n(61),s=n.n(c),i=n(115),a=n(89),l=n(12),r=n(1),u=n(118),j=n(663),d=n(60),h=n.n(d),p=n(664),b=n(789),O=n(90),m=n(171),g=n(16),x=n(718),v=n.n(x),f=(n(717),function(e){return Object(l.jsx)(l.Fragment,{children:Object(l.jsx)(j.N,{children:Object(l.jsx)(j.v,{action:"",method:"post",children:Object(l.jsxs)(j.R,{children:[Object(l.jsxs)(j.m,{xs:"7",children:[Object(l.jsxs)(j.w,{children:[Object(l.jsx)(j.K,{htmlFor:"surveyname",children:"Title"}),Object(l.jsx)(j.E,{type:"text",id:"surveyname",name:"surveyname",placeholder:"Enter Survey Title...",onChange:function(t){var n=t.target.value;e.handleChange(n,"surveyname")},value:e.values.surveyname}),Object(l.jsx)(j.x,{className:"help-block",children:"Please enter the survey title"})]}),Object(l.jsxs)(j.w,{children:[Object(l.jsx)(j.K,{htmlFor:"description",children:"Description"}),Object(l.jsx)(j.E,{type:"text",id:"description",name:"description",placeholder:"Enter Survey Description",onChange:function(t){var n=t.target.value;e.handleChange(n,"description")},value:e.values.description}),Object(l.jsx)(j.x,{className:"help-block",children:"*Optional"})]}),Object(l.jsxs)(j.w,{children:[Object(l.jsx)(j.K,{htmlFor:"template",children:"Template"}),Object(l.jsxs)(j.S,{onChange:function(t){var n=t.target.value;e.handleChange(n,"template")},value:e.values.template,custom:!0,name:"template",id:"template",children:[Object(l.jsx)("option",{value:"null",children:"Please Select"}),e.templates.map((function(e,t){return Object(l.jsx)("option",{value:e.id,children:e.Name})}))]}),Object(l.jsx)(j.x,{className:"help-block",children:"Please select a template"})]}),Object(l.jsxs)(j.w,{children:[Object(l.jsx)(j.K,{htmlFor:"questiongroup",children:"Question Group"}),Object(l.jsxs)(j.S,{onChange:function(t){e.setQuestionGroup(t)},value:e.values.questiongroup,custom:!0,name:"questiongroup",id:"questiongroup",children:[Object(l.jsx)("option",{value:"null",children:"Please Select"}),e.questiongroups.map((function(e,t){return Object(l.jsx)("option",{value:e.Name,children:e.Name})}))]}),Object(l.jsx)(j.x,{className:"help-block",children:"Please select a question group."})]}),Object(l.jsxs)(j.w,{children:[Object(l.jsx)(j.K,{htmlFor:"companyname",children:"Company Name"}),Object(l.jsx)(j.E,{onChange:function(t){var n=t.target.value;e.handleChange(n,"companyname")},value:e.values.companyname,type:"text",id:"companyname",name:"companyname",placeholder:"Enter Company Name"}),Object(l.jsx)(j.x,{className:"help-block",children:"Please enter the company name."})]})]}),Object(l.jsxs)(j.m,{xs:"5",children:[Object(l.jsxs)(j.w,{children:[Object(l.jsx)(j.K,{htmlFor:"startdate",children:"Start Date"}),Object(l.jsx)(v.a,{dateFormat:"dd/MM/yyyy",selected:e.values.startdate,onChange:function(t){t.getUTCMonth();e.setDate(t,"startdate")}}),Object(l.jsx)(j.x,{className:"help-block",children:"Please enter survey start date."})]}),Object(l.jsxs)(j.w,{children:[Object(l.jsx)(j.K,{htmlFor:"enddate",children:"End Date"}),Object(l.jsx)(v.a,{dateFormat:"dd/MM/yyyy",selected:e.values.enddate,onChange:function(t){e.setDate(t,"enddate")}}),Object(l.jsx)(j.x,{className:"help-block",children:"Please enter survey end date."})]}),Object(l.jsxs)(j.w,{children:[Object(l.jsx)(j.K,{htmlFor:"surveyvisibility",children:"Survey Type"}),Object(l.jsxs)(j.S,{onChange:function(t){var n=t.target.value;e.handleChange(n,"surveyvisibility")},value:e.values.surveyvisibility,custom:!0,name:"surveyvisibility",id:"surveyvisibility",children:[Object(l.jsx)("option",{value:"default",children:"Please Select"}),Object(l.jsx)("option",{value:"public",children:"Public Survey"}),Object(l.jsx)("option",{value:"private",children:"Private Survey"})]}),Object(l.jsx)(j.x,{className:"help-block",children:"Please select a question group."})]})]}),Object(l.jsx)(j.m,{xs:"12",children:Object(l.jsxs)(j.w,{row:!0,children:[Object(l.jsx)(j.K,{col:!0,md:"3",htmlFor:"logo",children:"Brand Logo"}),Object(l.jsx)(j.m,{xs:"12",md:"9",children:Object(l.jsx)(j.F,{onChange:function(t){e.setFiles(t,"logo")},defaultValue:e.values.logo,id:"logo",name:"logo"})})]})})]})})})})}),y=n(626),q=function(e){Object(r.useEffect)((function(){e.setAddedQuestions(d)}),[]);var t=Object(r.useState)([]),n=Object(a.a)(t,2),c=n[0],s=n[1],i=Object(r.useState)([{id:null,description:"",created_at:Date.now(),type:"",options:[],showSuggestion:!1}]),u=Object(a.a)(i,2),d=u[0],h=u[1],b=function(t,n){return function(c){var i=c.target.value;if(0===i.length)s([]);else{var a=new RegExp("^".concat(i),"i"),l=e.suggestions.sort().filter((function(e){return a.test(e.Description)}));console.log(l),s(l)}var r=Object(o.a)(d);switch(n){case"type":r[t].type=c.target.value,h(r),e.setAddedQuestions(r);break;case"question":r[t].description=c.target.value,h(r),e.setAddedQuestions(r);break;default:console.log("default")}}},O=function(e,t){var n=Object(o.a)(d);n[e].showSuggestion=t,h(n)};return Object(l.jsx)(l.Fragment,{children:Object(l.jsxs)(j.N,{children:[Object(l.jsx)(j.v,{action:"",method:"post",children:d.map((function(t,n){return Object(l.jsx)(l.Fragment,{children:Object(l.jsxs)(j.g,{children:[Object(l.jsxs)(j.k,{children:["Question-".concat(n+1),Object(l.jsx)(p.a,{content:y.a,onClick:function(){console.log(n),e.removeQuestion(n),function(e){var t=Object(o.a)(d);console.log(t),console.log(e);var n=t.splice(e,1);console.log(n),h(t)}(n)},style:{float:"right",cursor:"pointer"}})]}),Object(l.jsxs)(j.h,{children:[Object(l.jsx)(j.w,{children:Object(l.jsxs)(j.R,{children:[Object(l.jsx)(j.m,{md:"3",children:Object(l.jsx)(j.K,{htmlFor:"question-".concat(n),children:"Question"})}),Object(l.jsxs)(j.m,{xs:"12",md:"9",children:[Object(l.jsx)(j.E,{className:"question",name:"question-".concat(n),onChange:b(n,"question"),placeholder:"Question",value:d[n].description,onClick:function(){O(n,!0)},onBlur:function(){O(n,!1)}}),d[n].showSuggestion&&Object(l.jsx)(l.Fragment,{children:Object(l.jsx)("ul",{className:"suggestions",children:c.map((function(t,c){return Object(l.jsx)("li",{onMouseDown:function(c){e.setQuestions(t.id,n);var s=Object(o.a)(d);s[n].description=c.target.innerText,s[n].type=t.questiontype,s[n].id=t.id,s[n].options=[],new Promise((function(e,o){t.options.map((function(o,c){s[n].options.push({option:o.options,visiblity:!0}),c===t.options.length-1&&e()}))})).then((function(){h(s),e.setAddedQuestions(s)}))},className:"sugestion-item",children:t.Description})}))})}),Object(l.jsx)(j.x,{children:"This is a help text"})]})]})}),Object(l.jsx)(j.w,{children:Object(l.jsxs)(j.R,{children:[Object(l.jsx)(j.m,{md:"3",children:Object(l.jsx)(j.K,{htmlFor:"question-".concat(n,"-type"),children:"Type"})}),Object(l.jsx)(j.m,{xs:"12",md:"9",children:Object(l.jsx)(j.S,{custom:!0,name:"question-".concat(n,"-type"),id:"ccmonth",onChange:b(n,"type"),defaultValue:d[n].type,children:{"Multiple Choice":Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("option",{value:"Text",children:"Text"}),Object(l.jsx)("option",{selected:!0,value:"Multiple Choice",children:"Multiple Choice"}),Object(l.jsx)("option",{value:"Boolean",children:"Boolean"})]}),Boolean:Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("option",{value:"Text",children:"Text"}),Object(l.jsx)("option",{value:"Multiple Choice",children:"Multiple Choice"}),Object(l.jsx)("option",{selected:!0,value:"Boolean",children:"Boolean"})]}),Text:Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("option",{selected:!0,value:"Text",children:"Text"}),Object(l.jsx)("option",{value:"Multiple Choice",children:"Multiple Choice"}),Object(l.jsx)("option",{value:"Boolean",children:"Boolean"})]}),"":Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("option",{selected:!0,value:"",children:"Please Select"}),Object(l.jsx)("option",{value:"Text",children:"Text"}),Object(l.jsx)("option",{value:"Multiple Choice",children:"Multiple Choice"}),Object(l.jsx)("option",{value:"Boolean",children:"Boolean"})]})}[d[n].type]})})]})}),Object(l.jsxs)(j.w,{children:[Object(l.jsx)(j.R,{children:d[n].options.map((function(t,c){return Object(l.jsx)(l.Fragment,{children:t.visiblity&&Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(j.m,{md:"3",children:Object(l.jsx)(j.K,{htmlFor:"question-".concat(n,"-option"),children:"Option"})}),Object(l.jsx)(j.m,{xs:"12",md:"8",children:Object(l.jsx)(j.E,{onChange:function(t){!function(t,n,c){var s=t.target.value,i=Object(o.a)(d);i[n].options[c].option=s,h(i),e.setAddedQuestions(i)}(t,n,c)},placeholder:"Option",value:t.option,style:{marginBottom:15}})}),Object(l.jsx)(j.m,{xs:"12",md:"1",children:Object(l.jsx)(p.a,{style:{cursor:"pointer"},content:y.a,onClick:function(){!function(t,n){var c=Object(o.a)(d);console.log("index: ".concat(t,", i : ").concat(n)),console.log("option: ".concat(d[t].options[n])),d[t].options[n].visiblity=!1,h(c),e.setAddedQuestions(c)}(n,c)}})})]})})}))}),Object(l.jsx)(j.R,{children:Object(l.jsx)(j.m,{xs:"12",children:Object(l.jsx)(j.f,{block:!0,onClick:function(){!function(t){console.log("Option Added");var n=Object(o.a)(d);n[t].options.push({option:"",visiblity:!0}),h(n),e.setAddedQuestions(n)}(n)},color:"primary",children:"Add Option"})})})]})]})]})})}))}),Object(l.jsx)(j.m,{xs:"12",children:Object(l.jsx)(j.f,{block:!0,color:"primary",onClick:function(){var t={id:null,description:"",created_at:"",type:"",options:[]};new Promise((function(e,n){h((function(e){return[].concat(Object(o.a)(e),[t])})),e(t)})).then((function(){console.log("question added"),e.setAddedQuestions((function(e){return[].concat(Object(o.a)(e),[t])}))}))},style:{marginBottom:15},children:"Add Question"})})]})})},C=n(21),w=function(e){var t=Object(r.useRef)(),n=Object(r.useState)(!0),c=Object(a.a)(n,2),s=c[0],i=c[1],u=Object(r.useContext)(O.a),d=Object(C.g)(),p=Object(r.useState)([]),b=Object(a.a)(p,2),x=b[0],v=b[1],y=u.user,w=Object(r.useState)({step:1,surveyname:"",description:"",template:"",questiongroup:"",companyname:"",logo:[],startdate:new Date,enddate:new Date,surveyvisibility:"",questions:[]}),F=Object(a.a)(w,2),S=F[0],k=F[1],Q=Object(r.useState)([]),T=Object(a.a)(Q,2),N=T[0],P=T[1],D=Object(r.useState)([]),M=Object(a.a)(D,2),A=M[0],E=M[1],B=Object(r.useState)([]),K=Object(a.a)(B,2),U=K[0],R=K[1],G=Object(r.useState)([]),J=Object(a.a)(G,2),V=J[0],Y=J[1];Object(r.useEffect)((function(){t.current?S.surveyname&&S.description&&S.template&&S.questiongroup&&S.startdate&&S.enddate&&S.surveyvisibility&&S.logo.length>0&&S.companyname&&(console.log(s),i(!1)):(t.current=!0,_())}));var _=function(){h.a.get("http://139.59.244.122:1337/questiongroups").then((function(e){P((function(){return Object(o.a)(e.data)})),console.log(N)})),h.a.get("http://139.59.244.122:1337/templates").then((function(e){E((function(){return Object(o.a)(e.data)})),console.log(A)}))},z=function(){var e=S.step;k((function(t){return Object(g.a)(Object(g.a)({},t),{},{step:e+1})}))},I=function(e,t){k((function(n){return Object(g.a)(Object(g.a)({},n),{},Object(m.a)({},t,e))}))},L=(S.step,{surveyname:S.surveyname,description:S.description,template:S.template,companyname:S.companyname,questiongroup:S.questiongroup,startdate:S.startdate,enddate:S.enddate,logo:S.logo,surveyvisibility:S.surveyvisibility,questions:S.questions});return Object(l.jsx)(l.Fragment,{children:Object(l.jsxs)(j.M,{show:e.modal,onClose:function(){e.toggle(),S.step=1,k((function(e){return Object(g.a)(Object(g.a)({},e),{},{step:1,surveyname:"",description:"",template:"",companyname:"",questiongroup:"",startdate:"",enddate:"",logo:[],surveyvisibility:"",questions:""})}))},children:[Object(l.jsx)(j.P,{closeButton:!0,children:{1:"Create Survey",2:"Add Questions"}[S.step]}),{1:Object(l.jsx)(f,{templates:A,questiongroups:N,setDate:function(e,t){k((function(n){return Object(g.a)(Object(g.a)({},n),{},Object(m.a)({},t,e))}))},setFiles:function(e,t){var n=e.target.files;console.log(n),k((function(e){return Object(g.a)(Object(g.a)({},e),{},Object(m.a)({},t,n))}))},setQuestionGroup:function(e){new Promise((function(t,n){var o=e.target.value;k((function(e){return Object(g.a)(Object(g.a)({},e),{},{questiongroup:o})})),t(o)})).then((function(e){console.log(e);var t=N.find((function(t){return t.Name===e}));R((function(){return t.questionapis})),console.log(t.questionapis)}))},handleChange:I,values:L}),2:Object(l.jsx)(q,{setQuestions:function(e,t){var n=S.questions;console.log(t),console.log(n.length),t<=n.length?n[t]=e:n.push(e),k((function(e){return Object(g.a)(Object(g.a)({},e),{},{questions:n})}))},handleChange:I,suggestions:U,removeQuestion:function(e){var t=S.questions;t.splice(e,1),k((function(e){return Object(g.a)(Object(g.a)({},e),{},{questions:t})}))},survey:S,setAddedQuestions:Y}),3:Object(l.jsx)(l.Fragment,{children:Object(l.jsx)(j.g,{children:Object(l.jsxs)(j.h,{children:[Object(l.jsx)("h4",{children:"Sucessfully published the survey."}),Object(l.jsx)(j.a,{color:"primary",children:x[0]})]})})})}[S.step],Object(l.jsx)(j.O,{children:{1:Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(j.f,{color:"primary",disabled:s,onClick:function(){z()},children:"Proceed"}),Object(l.jsx)(j.f,{color:"secondary",onClick:function(){k((function(e){return Object(g.a)(Object(g.a)({},e),{},{step:1,surveyname:"",description:"",template:"",companyname:"",questiongroup:"",startdate:"",enddate:"",logo:[],surveyvisibility:"",questions:""})})),i(!0),e.toggle()},children:"Cancel"})]}),2:Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(j.f,{color:"success",onClick:function(){var e=[],t=N.find((function(e){return e.Name===S.questiongroup}));console.log(t.questionapis),console.log("Added Questions length: ".concat(V.length)),console.log("Question Group Questions length: ".concat(t.questionapis.length)),console.log(V),console.log(t.questionapis),console.log(t.questionapis.length),new Promise((function(n,o){for(var c=0;c<V.length;c++)for(var s=0;s<t.questionapis.length;s++){if(console.log("i:".concat(c,",j:").concat(s)),V[c].description===t.questionapis[s].Description){console.log("same");var i=t.questionapis[s].id;console.log(S.questions.includes(i)),S.questions.includes(i)||function(){var e=S.questions;e.push(i),k((function(t){return Object(g.a)(Object(g.a)({},t),{},{questions:e})}))}(),console.log("i:".concat(c,",j:").concat(s));break}s===t.questionapis.length-1&&(console.log("different"),e.push(V[c]),console.log(e),S.questions.includes(V[c].id)&&function(){console.log("duplicate found");var e=S.questions.indexOf(V[c].id);console.log("removing");var t=S.questions;t.splice(e,1),k((function(e){return Object(g.a)(Object(g.a)({},e),{},{questions:t})}))}(),e.map((function(e,t){e.options.map((function(t,n){t.visiblity||e.options.pop(n)}))})))}console.log(e),n(e)})).then((function(t){console.log(t),console.log("Unknown Questions:"),console.log(e),e.map((function(e){h.a.post("http://139.59.244.122:1337/questionapis",e).then((function(e){console.log(e);var t=S.questions;t.push(e.data.id),k((function(e){return Object(g.a)(Object(g.a)({},e),{},{questions:t})}))}))}))})).then((function(){var e=new FormData,t={};Array.from(S.logo).forEach((function(t){e.append("files",t)})),h.a.post("http://139.59.244.122:1337/upload",e,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){var n="".concat(S.startdate.getUTCFullYear(),"-").concat(S.startdate.getUTCMonth()+1,"-").concat(S.startdate.getUTCDate()),o="".concat(S.enddate.getUTCFullYear(),"-").concat(S.enddate.getUTCMonth()+1,"-").concat(S.enddate.getUTCDate());return t.surveyname=S.surveyname,t.description=S.description,t.owner=y.id,t.Startdate=n,t.Enddate=o,t.companyname=S.companyname,t.template=S.template,t.questiongroup=S.questiongroup,t.surveyvisibility=S.surveyvisibility,t.collaborators=[y.id],t.questions=S.questions,t.logo=e.data,t})).then((function(e){console.log(e),h.a.post("http://139.59.244.122:1337/surveyforms",e).then((function(e){return console.log(e.data),e.data})).then((function(e){e={surveyform:e.id},h.a.post("http://139.59.244.122:1337/publishsurveys",e).then((function(t){return console.log(t.data),v(t.data),e})).then((function(e){var t=e.surveyform;console.log(e);var n={surveyform:t,questionapis:S.questions};h.a.post("http://139.59.244.122:1337/surveyquestions",n).then((function(e){console.log(e.data),z()}))}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}))},children:"Submit"}),Object(l.jsx)(j.f,{color:"secondary",onClick:function(){k((function(e){return Object(g.a)(Object(g.a)({},e),{},{step:1})})),_(),e.toggle(),i(!0)},children:"Cancel"})]}),3:Object(l.jsx)(l.Fragment,{children:Object(l.jsx)(j.f,{onClick:function(){d.push("/")},color:"success",children:"Done"})})}[S.step]})]})})};t.default=function(){var e=Object(r.useContext)(O.a),t=e.user,n=Object(r.useState)([]),c=Object(a.a)(n,2),d=c[0],m=c[1],g=Object(r.useState)(!1),x=Object(a.a)(g,2),v=x[0],f=x[1],y=function(){console.log("Toggled"),f(!v)};Object(r.useEffect)((function(){h.a.get("http://139.59.244.122:1337/surveyforms?owner=".concat(t.id)).then(function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t.data),n=[],e.next=4,t.data.map((function(e,t){var o={id:e.id,surveyname:e.surveyname,thumbnail:e.previewimage?"http://139.59.244.122:1337".concat(e.previewimage.url):""};n.push(o)}));case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){m((function(){return Object(o.a)(e)}))})),e.loadUser()}),[]);return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(w,{modal:v,toggle:y}),Object(l.jsxs)(j.R,{children:[Object(l.jsx)(j.m,{sm:"6",lg:"3",children:Object(l.jsxs)(j.g,{onClick:function(){y(),console.log("Survey Added");var e={id:21,surveyname:"New Survey",thumbnail:"preivew.jpg"};m((function(t){return[].concat(Object(o.a)(t),[e])}))},style:{cursor:"pointer"},children:[Object(l.jsx)(j.h,{children:Object(l.jsx)(j.l,{children:Object(l.jsx)(p.b,{size:"lg",content:b.a.cilPlus})})}),Object(l.jsx)(j.i,{children:"Add Survey"})]})}),d.map((function(e,t){return Object(l.jsxs)(j.m,{sm:"6",lg:"3",children:[console.log(e),Object(l.jsx)(u.b,{to:"/survey/".concat(e.id),className:"surveyItems",children:Object(l.jsxs)(j.g,{style:{cursor:"pointer"},children:[Object(l.jsx)(j.h,{children:Object(l.jsx)(j.l,{src:"".concat(e.thumbnail)})}),Object(l.jsxs)(j.i,{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",color:"#3c4b64"},children:[e.surveyname,Object(l.jsx)("div",{className:"card-header-actions",style:{float:"right",position:"absolute",right:8},children:Object(l.jsx)(p.b,{content:b.a.cilOptions})})]})]})})]})}))]})]})}}}]);
//# sourceMappingURL=8.a2f543d7.chunk.js.map